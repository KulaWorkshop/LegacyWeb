<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Kula Workshop Level Viewer</title>
    <meta name="author" content="Murphy">
    <meta name="description" content="View level files from Kula World, Roll Away, or Kula Quest.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css.css">
    <link rel="apple-touch-icon" sizes="57x57" href="favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/manifest.json">
    <meta name="msapplication-TileImage" content="favicon/ms-icon-144x144.png">
</head>

<body>
    <div id="menu">
        <label for="browseOpen" id="bulabel" class="buttonFu">OPEN FILE</label>
        <input id="browseOpen" style="display: none;" type="file"/><br>
        <select id="wrldSelect" class="buttonFu">
            <option value="0">SELECT A WORLD</option>
            <optgroup label="Worlds">
                <option value="0">Egypt - HIRO</option>
                <option value="1">Alpine - HILLS</option>
                <option value="2">Aztec - INCA</option>
                <option value="3">Antarctica - ARCTIC</option>
                <option value="4">Rust - COWBOY</option>
                <option value="5">Mist - FIELD</option>
                <option value="6">Laser Quest - ATLANT</option>
                <option value="7">Dusk - HAZE</option>
                <option value="8">Mars - MARS</option>
                <option value="9">Apocalypse - HELL</option>
                <option value="10">Mine - CRAFT</option>
            </optgroup>
        </select><br>
        <button id="rstCam" class="buttonFu">RESET CAMERA</button>
    </div>
    <script type="module">
        import * as THREE from './js/build/three.module.js';

        import { OrbitControls } from './js/OrbitControls.js';

        var scene, renderer, camera, controls;      

        let hiro,hills,arctic,cowboy,inca,field,atlant,haze,mars,hell,minecraft,other,hexInput,itemString,itemArray2,itemArray,levelArray;

        levelArray = [];

        let world = 0;

        hiro = new THREE.TextureLoader();
        hills = new THREE.TextureLoader();
        arctic = new THREE.TextureLoader();
        cowboy = new THREE.TextureLoader();
        inca = new THREE.TextureLoader();
        field = new THREE.TextureLoader();
        atlant = new THREE.TextureLoader();
        haze = new THREE.TextureLoader();
        mars = new THREE.TextureLoader();
        hell = new THREE.TextureLoader();
        minecraft = new THREE.TextureLoader();
        other = new THREE.TextureLoader();
        hiro.setPath('textures/hiro/');
        hills.setPath('textures/hills/');
        arctic.setPath('textures/arctic/');
        cowboy.setPath('textures/cowboy/');
        inca.setPath('textures/inca/');
        field.setPath('textures/field/');
        atlant.setPath('textures/atlant/');
        haze.setPath('textures/haze/hazeNew/');
        mars.setPath('textures/mars/');
        hell.setPath('textures/hell/');
        minecraft.setPath('textures/minecraft/');
        other.setPath('textures/other/');

        let itemSprites = [
            other.load('coinSprite1.png'),//0
            other.load('slowstar.png'),//1
            other.load('faststar.png'),//2
            other.load('exitT.png'),//3
            other.load('key.png'),//4
            other.load('banana.png'),//5
            other.load('nauspill.png'),//6
            other.load('bounpill.png'),//7
            other.load('invincpill.png'),//8
            other.load('sonic.png'),//9
            other.load('hiddenExitT.png'),//10
            other.load('sunglasses.png'),//11
            other.load('timer.png'),//12
            other.load('gem.png'),//13
            other.load('ballsprite.png'),//14
            other.load('captivator.png'),//15
            other.load('wheelio.png'),//16
            other.load('trampoline.png'),//17
            other.load('arrow.png'),//18
            other.load('coinSprite2.png'),//19
            other.load('coinSprite3.png'),//20
            other.load('yeltrans.png'),//21
            other.load('blutrans.png'),//22
            other.load('grentrans.png'),//23
            other.load('redtrans.png'),//24
            other.load('yelbutt.png'),//25
            other.load('blubutt.png'),//26
            other.load('grenbutt.png'),//27
            other.load('redbutt.png'),//28
            other.load('capturepod.png'),//29
            other.load('gem2.png'),//30
            other.load('gem3.png'),//31
        ]

        let worldTextures = [
            [
                //Tiles
                [
                    hiro.load('tile1.png'),
                    hiro.load('tile2.png'),
                    hiro.load('tile3.png'),
                    hiro.load('tile4.png')
                ],
                //Special Tiles
                hiro.load('fire.png'),      //1 Fire
                hiro.load('ice.png'),       //2 Ice
                hiro.load('invisible.png'), //3 Invisible
                hiro.load('acid.png'),      //4 Acid
                hiro.load('crumble.png'),   //5 Crumble
                //Item Shadows
                hiro.load('tileItem.png'),  //6 Tile Item
                hiro.load('iceItem.png'),   //7 Ice Item
                //Spikes
                hiro.load('4spikes.png'),   //8 4 Spikes
                hiro.load('12spikes.png'),  //9 12 Spikes
                //Other
                hiro.load('timestop.png'),  //10 Time Stop
                hiro.load('buttonbase.png'),//11 Button Base
                hiro.load('exit.png'),      //12 Exit
                //<2 moving block sides
                [
                    hiro.load('cyborg1.png'),
                    hiro.load('cyborg2.png')
                ],
                //>2 moving block sides/end
                [
                    hiro.load('robotEnd.png'),
                    hiro.load('robotSide.png')
                ],
                //Lasers
                [
                    hiro.load('laser1.png'),
                    hiro.load('laser2.png'),
                    hiro.load('laser3.png'),
                    hiro.load('laser4.png')
                ],
            ],
            [
                //Tiles
                [
                    hills.load('tile1.png'),
                    hills.load('tile2.png'),
                    hills.load('tile3.png'),
                    hills.load('tile4.png')
                ],
                //Special Tiles
                hills.load('fire.png'),      //1 Fire
                hills.load('ice.png'),       //2 Ice
                hills.load('invisible.png'), //3 Invisible
                hills.load('acid.png'),      //4 Acid
                hills.load('crumble.png'),   //5 Crumble
                //Item Shadows
                hills.load('tileItem.png'),  //6 Tile Item
                hills.load('iceItem.png'),   //7 Ice Item
                //Spikes
                hills.load('4spikes.png'),   //8 4 Spikes
                hills.load('12spikes.png'),  //9 12 Spikes
                //Other
                hills.load('timestop.png'),  //10 Time Stop
                hills.load('buttonbase.png'),//11 Button Base
                hills.load('exit.png'),      //12 Exit
                //<2 moving block sides
                [
                    hills.load('cyborg1.png'),
                    hills.load('cyborg2.png')
                ],
                //>2 moving block sides/end
                [
                    hills.load('robotEnd.png'),
                    hills.load('robotSide.png')
                ],
                //Lasers
                [
                    hills.load('laser1.png'),
                    hills.load('laser2.png'),
                    hills.load('laser3.png'),
                    hills.load('laser4.png')
                ],
            ],
            [
                //Tiles
                [
                    inca.load('tile1.png'),
                    inca.load('tile2.png'),
                    inca.load('tile3.png'),
                    inca.load('tile4.png')
                ],
                //Special Tiles
                inca.load('fire.png'),      //1 Fire
                inca.load('ice.png'),       //2 Ice
                inca.load('invisible.png'), //3 Invisible
                inca.load('acid.png'),      //4 Acid
                inca.load('crumble.png'),   //5 Crumble
                //Item Shadows
                inca.load('tileItem.png'),  //6 Tile Item
                inca.load('iceItem.png'),   //7 Ice Item
                //Spikes
                inca.load('4spikes.png'),   //8 4 Spikes
                inca.load('12spikes.png'),  //9 12 Spikes
                //Other
                inca.load('timestop.png'),  //10 Time Stop
                inca.load('buttonbase.png'),//11 Button Base
                inca.load('exit.png'),      //12 Exit
                //<2 moving block sides
                [
                    inca.load('cyborg1.png'),
                    inca.load('cyborg2.png')
                ],
                //>2 moving block sides/end
                [
                    inca.load('robotEnd.png'),
                    inca.load('robotSide.png')
                ],
                //Lasers
                [
                    inca.load('laser1.png'),
                    inca.load('laser2.png'),
                    inca.load('laser3.png'),
                    inca.load('laser4.png')
                ],
            ],
            [
                //Tiles
                [
                    arctic.load('tile1.png'),
                    arctic.load('tile2.png'),
                    arctic.load('tile3.png'),
                    arctic.load('tile4.png')
                ],
                //Special Tiles
                arctic.load('fire.png'),      //1 Fire
                arctic.load('ice.png'),       //2 Ice
                arctic.load('invisible.png'), //3 Invisible
                arctic.load('acid.png'),      //4 Acid
                arctic.load('crumble.png'),   //5 Crumble
                //Item Shadows
                arctic.load('tileItem.png'),  //6 Tile Item
                arctic.load('iceItem.png'),   //7 Ice Item
                //Spikes
                arctic.load('4spikes.png'),   //8 4 Spikes
                arctic.load('12spikes.png'),  //9 12 Spikes
                //Other
                arctic.load('timestop.png'),  //10 Time Stop
                arctic.load('buttonbase.png'),//11 Button Base
                arctic.load('exit.png'),      //12 Exit
                //<2 moving block sides
                [
                    arctic.load('cyborg1.png'),
                    arctic.load('cyborg2.png')
                ],
                //>2 moving block sides/end
                [
                    arctic.load('robotEnd.png'),
                    arctic.load('robotSide.png')
                ],
                //Lasers
                [
                    arctic.load('laser1.png'),
                    arctic.load('laser2.png'),
                    arctic.load('laser3.png'),
                    arctic.load('laser4.png')
                ],
            ],
            [
                //Tiles
                [
                    cowboy.load('tile1.png'),
                    cowboy.load('tile2.png'),
                    cowboy.load('tile3.png'),
                    cowboy.load('tile4.png')
                ],
                //Special Tiles
                cowboy.load('fire.png'),      //1 Fire
                cowboy.load('ice.png'),       //2 Ice
                cowboy.load('invisible.png'), //3 Invisible
                cowboy.load('acid.png'),      //4 Acid
                cowboy.load('crumble.png'),   //5 Crumble
                //Item Shadows
                cowboy.load('tileItem.png'),  //6 Tile Item
                cowboy.load('iceItem.png'),   //7 Ice Item
                //Spikes
                cowboy.load('4spikes.png'),   //8 4 Spikes
                cowboy.load('12spikes.png'),  //9 12 Spikes
                //Other
                cowboy.load('timestop.png'),  //10 Time Stop
                cowboy.load('buttonbase.png'),//11 Button Base
                cowboy.load('exit.png'),      //12 Exit
                //<2 moving block sides
                [
                    cowboy.load('cyborg1.png'),
                    cowboy.load('cyborg2.png')
                ],
                //>2 moving block sides/end
                [
                    cowboy.load('robotEnd.png'),
                    cowboy.load('robotSide.png')
                ],
                //Lasers
                [
                    cowboy.load('laser1.png'),
                    cowboy.load('laser2.png'),
                    cowboy.load('laser3.png'),
                    cowboy.load('laser4.png')
                ],
            ],
            [
                //Tiles
                [
                    field.load('tile1.png'),
                    field.load('tile2.png'),
                    field.load('tile3.png'),
                    field.load('tile4.png')
                ],
                //Special Tiles
                field.load('fire.png'),      //1 Fire
                field.load('ice.png'),       //2 Ice
                field.load('invisible.png'), //3 Invisible
                field.load('acid.png'),      //4 Acid
                field.load('crumble.png'),   //5 Crumble
                //Item Shadows
                field.load('tileItem.png'),  //6 Tile Item
                field.load('iceItem.png'),   //7 Ice Item
                //Spikes
                field.load('4spikes.png'),   //8 4 Spikes
                field.load('12spikes.png'),  //9 12 Spikes
                //Other
                field.load('timestop.png'),  //10 Time Stop
                field.load('buttonbase.png'),//11 Button Base
                field.load('exit.png'),      //12 Exit
                //<2 moving block sides
                [
                    field.load('cyborg1.png'),
                    field.load('cyborg2.png')
                ],
                //>2 moving block sides/end
                [
                    field.load('robotEnd.png'),
                    field.load('robotSide.png')
                ],
                //Lasers
                [
                    field.load('laser1.png'),
                    field.load('laser2.png'),
                    field.load('laser3.png'),
                    field.load('laser4.png')
                ],
            ],
            [
                //Tiles
                [
                    atlant.load('tile1.png'),
                    atlant.load('tile2.png'),
                    atlant.load('tile3.png'),
                    atlant.load('tile4.png')
                ],
                //Special Tiles
                atlant.load('fire.png'),      //1 Fire
                atlant.load('ice.png'),       //2 Ice
                atlant.load('invisible.png'), //3 Invisible
                atlant.load('acid.png'),      //4 Acid
                atlant.load('crumble.png'),   //5 Crumble
                //Item Shadows
                atlant.load('tileItem.png'),  //6 Tile Item
                atlant.load('iceItem.png'),   //7 Ice Item
                //Spikes
                atlant.load('4spikes.png'),   //8 4 Spikes
                atlant.load('12spikes.png'),  //9 12 Spikes
                //Other
                atlant.load('timestop.png'),  //10 Time Stop
                atlant.load('buttonbase.png'),//11 Button Base
                atlant.load('exit.png'),      //12 Exit
                //<2 moving block sides
                [
                    atlant.load('cyborg1.png'),
                    atlant.load('cyborg2.png')
                ],
                //>2 moving block sides/end
                [
                    atlant.load('robotEnd.png'),
                    atlant.load('robotSide.png')
                ],
                //Lasers
                [
                    atlant.load('laser1.png'),
                    atlant.load('laser2.png'),
                    atlant.load('laser3.png'),
                    atlant.load('laser4.png')
                ],
            ],
            [
                //Tiles
                [
                    haze.load('tile1.png'),
                    haze.load('tile2.png'),
                    haze.load('tile3.png'),
                    haze.load('tile4.png')
                ],
                //Special Tiles
                haze.load('fire.png'),      //1 Fire
                haze.load('ice.png'),       //2 Ice
                haze.load('invisible.png'), //3 Invisible
                haze.load('acid.png'),      //4 Acid
                haze.load('crumble.png'),   //5 Crumble
                //Item Shadows
                haze.load('tileItem.png'),  //6 Tile Item
                haze.load('iceItem.png'),   //7 Ice Item
                //Spikes
                haze.load('4spikes.png'),   //8 4 Spikes
                haze.load('12spikes.png'),  //9 12 Spikes
                //Other
                haze.load('timestop.png'),  //10 Time Stop
                haze.load('buttonbase.png'),//11 Button Base
                haze.load('exit.png'),      //12 Exit
                //<2 moving block sides
                [
                    haze.load('cyborg1.png'),
                    haze.load('cyborg2.png')
                ],
                //>2 moving block sides/end
                [
                    haze.load('robotEnd.png'),
                    haze.load('robotSide.png')
                ],
                //Lasers
                [
                    haze.load('laser1.png'),
                    haze.load('laser2.png'),
                    haze.load('laser3.png'),
                    haze.load('laser4.png')
                ],
            ],
            [
                //Tiles
                [
                    mars.load('tile1.png'),
                    mars.load('tile2.png'),
                    mars.load('tile3.png'),
                    mars.load('tile4.png')
                ],
                //Special Tiles
                mars.load('fire.png'),      //1 Fire
                mars.load('ice.png'),       //2 Ice
                mars.load('invisible.png'), //3 Invisible
                mars.load('acid.png'),      //4 Acid
                mars.load('crumble.png'),   //5 Crumble
                //Item Shadows
                mars.load('tileItem.png'),  //6 Tile Item
                mars.load('iceItem.png'),   //7 Ice Item
                //Spikes
                mars.load('4spikes.png'),   //8 4 Spikes
                mars.load('12spikes.png'),  //9 12 Spikes
                //Other
                mars.load('timestop.png'),  //10 Time Stop
                mars.load('buttonbase.png'),//11 Button Base
                mars.load('exit.png'),      //12 Exit
                //<2 moving block sides
                [
                    mars.load('cyborg1.png'),
                    mars.load('cyborg2.png')
                ],
                //>2 moving block sides/end
                [
                    mars.load('robotEnd.png'),
                    mars.load('robotSide.png')
                ],
                //Lasers
                [
                    mars.load('laser1.png'),
                    mars.load('laser2.png'),
                    mars.load('laser3.png'),
                    mars.load('laser4.png')
                ],
            ],
            [
                //Tiles
                [
                    hell.load('tile1.png'),
                    hell.load('tile2.png'),
                    hell.load('tile3.png'),
                    hell.load('tile4.png')
                ],
                //Special Tiles
                hell.load('fire.png'),      //1 Fire
                hell.load('ice.png'),       //2 Ice
                hell.load('invisible.png'), //3 Invisible
                hell.load('acid.png'),      //4 Acid
                hell.load('crumble.png'),   //5 Crumble
                //Item Shadows
                hell.load('tileItem.png'),  //6 Tile Item
                hell.load('iceItem.png'),   //7 Ice Item
                //Spikes
                hell.load('4spikes.png'),   //8 4 Spikes
                hell.load('12spikes.png'),  //9 12 Spikes
                //Other
                hell.load('timestop.png'),  //10 Time Stop
                hell.load('buttonbase.png'),//11 Button Base
                hell.load('exit.png'),      //12 Exit
                //<2 moving block sides
                [
                    hell.load('cyborg1.png'),
                    hell.load('cyborg2.png')
                ],
                //>2 moving block sides/end
                [
                    hell.load('robotEnd.png'),
                    hell.load('robotSide.png')
                ],
                //Lasers
                [
                    hell.load('laser1.png'),
                    hell.load('laser2.png'),
                    hell.load('laser3.png'),
                    hell.load('laser4.png')
                ],
            ],
            [
                //Tiles
                [
                    minecraft.load('tile1.png'),
                    minecraft.load('tile2.png'),
                    minecraft.load('tile3.png'),
                    minecraft.load('tile4.png')
                ],
                //Special Tiles
                minecraft.load('fire.png'),      //1 Fire
                minecraft.load('ice.png'),       //2 Ice
                minecraft.load('invisible.png'), //3 Invisible
                minecraft.load('acid.png'),      //4 Acid
                minecraft.load('crumble.png'),   //5 Crumble
                //Item Shadows
                minecraft.load('tileItem.png'),  //6 Tile Item
                minecraft.load('iceItem.png'),   //7 Ice Item
                //Spikes
                minecraft.load('4spikes.png'),   //8 4 Spikes
                minecraft.load('12spikes.png'),  //9 12 Spikes
                //Other
                minecraft.load('timestop.png'),  //10 Time Stop
                minecraft.load('buttonbase.png'),//11 Button Base
                minecraft.load('exit.png'),      //12 Exit
                //<2 moving block sides
                [
                    minecraft.load('cyborg1.png'),
                    minecraft.load('cyborg2.png')
                ],
                //>2 moving block sides/end
                [
                    minecraft.load('robotEnd.png'),
                    minecraft.load('robotSide.png')
                ],
                //Lasers
                [
                    minecraft.load('laser1.png'),
                    minecraft.load('laser2.png'),
                    minecraft.load('laser3.png'),
                    minecraft.load('laser4.png')
                ],
            ]
        ];

        function getBlockFromID(id){
            switch(id){
                case 0:return "Basic Tile";         break;
                case 1:return "Fire Tile";          break;
                case 2:return "Ice Tile";           break;
                case 3:return "Invisible Tile";     break;
                case 4:return "Acid Tile";          break;
                case 5:return "Crumble Tile";       break;
                case 6:return "Basic Item Tile";    break;
                case 7:return "Ice Item Tile";      break;
                case 8:return "4 Spike Tile";       break;
                case 9:return "12 Spike Tile";      break;
                case 10:return "Time Stop Tile";    break;
                case 11:return "Button Base Tile";  break;
                case 12:return "Exit Tile";         break;

            }
        }

        function genSprite(id){
            return new THREE.SpriteMaterial({map: itemSprites[id]});
        }


        function generateTexture(world, posX=0, negX=0, posY=0, negY=0, posZ=0, negZ=0){
            function genMat(wrld,type){
                let temp
                switch(type){
                    case 0:
                        temp = worldTextures[wrld][0][Math.floor(Math.random() * 4)];
                        //temp.center.set(0.5,0.5);
                        //temp.rotation = (1.5708*(Math.floor(Math.random() * 4) + 1));
                        return new THREE.MeshBasicMaterial( {map:temp} );
                        break;
                    case 3:
                        temp = new THREE.MeshBasicMaterial( {map:worldTextures[wrld][type],opacity:0.5,transparent:true} );
                        temp.blending = THREE["AdditiveBlending"];
                        return temp;
                        break;
                    case 16:
                        temp = worldTextures[wrld][0][Math.floor(Math.random() * 4)];
                        //temp.center.set(0.5,0.5);
                        //temp.rotation = (1.5708*(Math.floor(Math.random() * 4) + 1));
                        return new THREE.MeshBasicMaterial( {map:temp,opacity:0.5,transparent:true} );
                        break;
                    default:
                        return new THREE.MeshBasicMaterial( {map:worldTextures[wrld][type]} );

                }
            }
            return [
                genMat(world,posX),//Pos X
                genMat(world,negX),//Neg X
                genMat(world,posY), //Pos Y
                genMat(world,negY),//Neg Y
                genMat(world,posZ),//Pos Z
                genMat(world,negZ)//Neg Z
            ]
        }

        const box = new THREE.BoxBufferGeometry();

        function init() {

            scene = new THREE.Scene();
            scene.background = new THREE.Color( 0x4d76ff );
            scene.fog = new THREE.FogExp2( 0xcccccc, 0.002 );
            function clearBlocks(){
                while (scene.children.length > 0) {
                    scene.remove(scene.children[0]);
                }
            }

            renderer = new THREE.WebGLRenderer( { antialias: true } );
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize( window.innerWidth, window.innerHeight );
            document.body.appendChild( renderer.domElement );

            camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 0.01, 1000 );
            camera.position.set( 40, 20, 0 );
            camera.frustumCulled = false;

            // controls

            controls = new OrbitControls( camera, renderer.domElement );
            controls.target.set( -17, -17, 17 );
            controls.minDistance = 0;
            controls.maxDistance = 500;

            // world
            
            
            
            document.getElementById('rstCam').onclick = function(){
                
                let itemTest = new THREE.Sprite(genSprite(1));
                itemTest.position.y += 1;
                mesh[12].add(itemTest)
                console.log(scene);
            };

            function deterSprite(item) {
                console.log(item)
                switch(item.substring(6,8)) {
                    case "05":
                        switch(item.substring(14,16)) {
                            case "00":
                                return 21;
                                break;
                            case "01":
                                return 22;
                                break;
                            case "02":
                                return 23;
                                break;
                            case "03":
                                return 24;
                                break;
                            default:
                                return null;
                                break;
                        }
                        break;
                    case "09":
                        switch(item.substring(14,16)) {
                            case "00":
                                return 25;
                                break;
                            case "01":
                                return 26;
                                break;
                            case "02":
                                return 27;
                                break;
                            case "03":
                                return 28;
                                break;
                            default:
                                return null;
                                break;
                        }
                        break;
                    case "25":
                        switch(item.substring(14,16)) {
                            case "00":
                                return 20;
                                break;
                            case "01":
                                return 19;
                                break;
                            case "02":
                                return 0;
                                break;
                            default:
                                return 0;
                                break;
                        }
                        break;
                    case "32":
                        return 1;
                        break;
                    case "35":
                        return 29;
                        break;
                    case "34":
                        return 2;
                        break;
                    case "07":
                        return 3;
                        break;
                    case "1F":
                        return 4;
                        break;
                    case "2E":
                        return 5;
                        break;
                    case "20":
                        return 6;
                        break;
                    case "21":
                        return 7;
                        break;
                    case "22":
                        return 8;
                        break;
                    case "2A":
                        return 9;
                        break;
                    case "1A":
                        return 10;
                        break;
                    case "26":
                        return 11;
                        break;
                    case "23":
                        return 12;
                        break;
                    case "24":
                        switch(item.substring(14,16)) {
                            case "00":
                                return 13;
                                break;
                            case "01":
                                return 30;
                                break;
                            case "02":
                                return 31;
                                break;
                            default:
                                return 13;
                                break;
                        }
                        break;
                    case "1D":
                    case "1E":
                        return 14;
                        break;
                    case "38":
                        return 15;
                    case "33":
                        return 16;
                        break;
                    case "0A":
                        return 17;
                        break;
                    case "1C":
                        return 18;
                        break;
                    default:
                        return null;
                        break;
                }
            }

            function itemDets(itemID, block){
                switch(block){
                    case "00":
                    case "02":
                    default:
                        switch(itemID){
                            default:
                                switch(block){
                                    case "00":return 0;break;
                                    case "02":return 2;break;
                                };
                                break;
                            case "01":return 1;break;//Fire Patch
                            case "02":return 2;break;//Ice Patch
                            case "03":return 3;break;//Invisible Patch
                            case "04":return 4;break;//Acid Patch
                            case "08":case "1D":return 10;break;//Time Stop
                            case "07":return 12;break;//Exit
                            case "0B":return 8;break;//4 Spikes
                            case "0C":return 9;break;//12 Spikes
                            //Telebujump Base
                            case "05"://Transporter
                            case "09"://Button
                            case "0A"://Bounce
                                return 11;break;
                            //Shadows
                            case "1F"://Key
                            case "20"://Nausea Pill
                            case "21"://Bouncy Pill
                            case "22"://Invincibility Pill
                            case "23"://Timer Flip
                            case "24"://Gem
                            case "25"://Coin
                            case "26"://Sunglasses
                            case "2B"://Apple
                            case "2C"://Watermelon
                            case "2D"://Pumpkin
                            case "2E"://Banana
                            case "2F"://Strawberry
                                switch(block){
                                    case "00":return 6;break;
                                    case "02":return 7;break;
                                }
                                break;
                        };
                    break;
                    case "01":
                        switch(itemID){
                            default:return 1;break;
                            case "01":return 1;break;//Fire Patch
                            case "02":return 2;break;//Ice Patch
                            case "03":return 3;break;//Invisible Patch
                            case "04":return 4;break;//Acid Patch
                            case "08":case "1D":return 10;break;//Time Stop
                            case "07":return 12;break;//Exit
                            case "0B":return 8;break;//4 Spikes
                            case "0C":return 9;break;//12 Spikes
                            //Telebujump Base
                            case "05"://Transporter
                            case "09"://Button
                            case "0A"://Bounce
                                return 11;break;
                        }
                        break;
                    case "03":
                        switch(itemID){
                            default:return 3;break;
                            case "01":return 1;break;//Fire Patch
                            case "02":return 2;break;//Ice Patch
                            case "03":return 3;break;//Invisible Patch
                            case "04":return 4;break;//Acid Patch
                            case "08":case "1D":return 10;break;//Time Stop
                            case "07":return 12;break;//Exit
                            case "0B":return 8;break;//4 Spikes
                            case "0C":return 9;break;//12 Spikes
                            //Telebujump Base
                            case "05"://Transporter
                            case "09"://Button
                            case "0A"://Bounce
                                return 11;break;
                        }
                        break;
                    case "04":
                        switch(itemID){
                            default:return 4;break;
                            case "01":return 1;break;//Fire Patch
                            case "02":return 2;break;//Ice Patch
                            case "03":return 3;break;//Invisible Patch
                            case "04":return 4;break;//Acid Patch
                            case "08":case "1D":return 10;break;//Time Stop
                            case "07":return 12;break;//Exit
                            case "0B":return 8;break;//4 Spikes
                            case "0C":return 9;break;//12 Spikes
                            //Telebujump Base
                            case "05"://Transporter
                            case "09"://Button
                            case "0A"://Bounce
                                return 11;break;
                        }
                        break;
                    case "05":
                        switch(itemID){
                            default:return 0;break;
                            case "01":return 1;break;//Fire Patch
                            case "02":return 2;break;//Ice Patch
                            case "03":return 3;break;//Invisible Patch
                            case "04":return 4;break;//Acid Patch
                            case "08":case "1D":return 10;break;//Time Stop
                            case "07":return 12;break;//Exit
                            case "0B":return 8;break;//4 Spikes
                            case "0C":return 9;break;//12 Spikes
                            //Telebujump Base
                            case "05"://Transporter
                            case "09"://Button
                            case "0A"://Bounce
                                return 11;break;
                        }
                        break;
                    case "06":
                        return 5;
                        break;
                    case "07":
                        return 16;
                        break;
                    case "08":
                        switch(itemID){
                            default:return 0;break;
                            case "01":return 1;break;//Fire Patch
                            case "02":return 2;break;//Ice Patch
                            case "03":return 3;break;//Invisible Patch
                            case "04":return 4;break;//Acid Patch
                            case "08":case "1D":return 10;break;//Time Stop
                            case "07":return 12;break;//Exit
                            case "0B":return 8;break;//4 Spikes
                            case "0C":return 9;break;//12 Spikes
                            //Telebujump Base
                            case "05"://Transporter
                            case "09"://Button
                            case "0A"://Bounce
                                return 11;break;
                        }
                        break;
                }
                
            };

            function loadLevel(){
                clearBlocks();
                let positionArray = [0,0,0];
                let atCoord = 0;
                let atBlock = 0;
                let blocksArray = [];
                let cubeSides = [];
                let cubeItems = [];
                let itemNumber = 0;
                let physItemArray = [[],[],[],[],[],[]];
                while(positionArray[0] < 34) {//Z
                    while(positionArray[1] < 34) {//X
                        while(positionArray[2] < 34) {///Y
                            switch(levelArray[atCoord]){
                                case "FFFF":break;
                                case "0000":
                                    blocksArray[atBlock] = new THREE.Mesh( box, generateTexture(world) );
                                    break;
                                case "0100":
                                    blocksArray[atBlock] = new THREE.Mesh( box, generateTexture(world,1,1,1,1,1,1) );
                                    break;
                                case "0200":
                                    blocksArray[atBlock] = new THREE.Mesh( box, generateTexture(world,2,2,2,2,2,2) );
                                    break;
                                case "0300":
                                    blocksArray[atBlock] = new THREE.Mesh( box, generateTexture(world,3,3,3,3,3,3) );
                                    break;
                                case "0400":
                                    blocksArray[atBlock] = new THREE.Mesh( box, generateTexture(world,4,4,4,4,4,4) );
                                    break;
                                default:
                                    cubeSides = [
                                        itemDets(itemArray[itemNumber][0].substring(6,8),itemArray[itemNumber][0].substring(2,4)),
                                        itemDets(itemArray[itemNumber][1].substring(6,8),itemArray[itemNumber][0].substring(2,4)),
                                        itemDets(itemArray[itemNumber][2].substring(6,8),itemArray[itemNumber][0].substring(2,4)),
                                        itemDets(itemArray[itemNumber][3].substring(6,8),itemArray[itemNumber][0].substring(2,4)),
                                        itemDets(itemArray[itemNumber][4].substring(6,8),itemArray[itemNumber][0].substring(2,4)),
                                        itemDets(itemArray[itemNumber][5].substring(6,8),itemArray[itemNumber][0].substring(2,4))
                                    ];
                                    cubeItems = [
                                        deterSprite(itemArray[itemNumber][0]),
                                        deterSprite(itemArray[itemNumber][1]),
                                        deterSprite(itemArray[itemNumber][2]),
                                        deterSprite(itemArray[itemNumber][3]),
                                        deterSprite(itemArray[itemNumber][4]),
                                        deterSprite(itemArray[itemNumber][5])
                                    ]
                                    blocksArray[atBlock] = new THREE.Mesh( box, generateTexture(world,cubeSides[3],cubeSides[2],cubeSides[0],cubeSides[5],cubeSides[1],cubeSides[4]) );
                                    for (let i = 0; i < cubeItems.length; i++) {
                                        if (cubeItems[i] !== null) {
                                            let temp = new THREE.Sprite(genSprite(cubeItems[i]))
                                            blocksArray[atBlock].add(temp)
                                            switch(i) {
                                                case 0:
                                                    temp.position.y += 1;
                                                    break;
                                                case 5:
                                                    temp.position.y -= 1;
                                                    break;
                                                case 3:
                                                    temp.position.x += 1;
                                                    break;
                                                case 2:
                                                    temp.position.x -= 1;
                                                    break;
                                                case 1:
                                                    temp.position.z += 1;
                                                    break;
                                                case 4:
                                                    temp.position.z -= 1;
                                                    break;
                                                default:
                                                    console.log('Something went wrong here.');
                                            }
                                        }
                                    }
                                    itemNumber++;
                                    break;
                            };

                            if(levelArray[atCoord] !== "FFFF"){
                                blocksArray[atBlock].position.x = (-1 * positionArray[1]);
                                blocksArray[atBlock].position.y = (-1 * positionArray[2]);
                                blocksArray[atBlock].position.z = positionArray[0];
                                blocksArray[atBlock].name = atCoord;
                                blocksArray[atBlock].updateMatrix();
                                atBlock++;
                            }
                            
                            positionArray[2]++;
                            atCoord++;
                        };
                        positionArray[2] = 0;
                        positionArray[1]++;
                    };
                    positionArray[1] = 0;
                    positionArray[0]++;
                };
                for(let i = 0; i < blocksArray.length; i++){
                    scene.add( blocksArray[i] );
                };
                console.log(scene);
            };

            let fileInput = document.getElementById("browseOpen");
            fileInput.onchange = function () {            
                let fr = new FileReader();
                fr.onloadend = function () {
                    let result = this.result;
                    let hex = "";
                    for (let i = 0; i < this.result.length; i++) {
                        let byteStr = result.charCodeAt(i).toString(16);
                        if (byteStr.length < 2) {
                            byteStr = "0" + byteStr;
                        }
                        hex += byteStr;
                    }
                    hexInput = hex.toUpperCase();
                    itemString = hexInput.substring(157226, (hexInput.length + 1));
                    levelArray = [];
                    itemArray2 = [];
                    itemArray = [];
                    for (let i = 0; i < 39304; i++) {
                        try {
                            levelArray[i] = hexInput.substring((i * 4), ((i * 4) + 4));
                        } catch {}
                    }
                    for (let i = 0; i < itemString.length;){
                        itemArray2.push(itemString.substring(i,(i+512)));
                        i+=512;
                    }
                    for(let i = 0; i < (itemArray2.length - 2);i++){
                        let stringy = itemArray2[i];
                        itemArray[i] = [
                            stringy.substring(0,64),
                            stringy.substring(64,128),
                            stringy.substring(128,192),
                            stringy.substring(192,256),
                            stringy.substring(256,320),
                            stringy.substring(320,384),
                        ]
                    }
                    loadLevel();
                };
                fr.readAsBinaryString(this.files[0]);
            };

            let worldChange = document.getElementById('wrldSelect');
            worldChange.onchange = function(){
                world = parseInt(worldChange.value);
                if(levelArray.length > 0){
                    loadLevel();
                }
                console.log(world);
            }

            window.addEventListener( 'resize', onWindowResize );

        }


        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize( window.innerWidth, window.innerHeight );

        }

        function animate() {

            requestAnimationFrame( animate );

            render();

        }


        function render() {

            renderer.render( scene, camera );

        }

        init();
        animate();

    </script>

</body>
</html>
